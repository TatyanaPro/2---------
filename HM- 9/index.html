<!DOCTYPE html>
<html>

<head>
  <title>Проект "Комменты"</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <ul class="comments" id="list-comments">
    </ul>
    <div class="add-form">
      <input type="text" id="text-name" value="" class="add-form-name" placeholder="Введите ваше имя" />
      <textarea type="textarea" id="text-comment" value="" class="add-form-text" placeholder="Введите ваш коментарий"
        rows="4"></textarea>
      <div class="add-form-row">
        <button class="add-form-button" id="add-button">Написать</button>
      </div>
    </div>
  </div>
</body>

<style>
  .error {
    border-color: red;
    border-width: 8px;
  }
</style>

<script>
  "use strict";
  const buttonElement = document.getElementById('add-button');
  const listElement = document.getElementById('list-comments');
  const nameInputElement = document.getElementById('text-name');
  const commentInputElement = document.getElementById('text-comment');
  const date = new Date();

  function getCurrentDate() {
    const now = new Date();
    const day = now.getDate().toString().padStart(2, '0');
    const month = (now.getMonth() + 1).toString().padStart(2, '0');
    const year = now.getFullYear().toString();
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    return `${day}.${month}.${year} ${hours}:${minutes}`;
  };  

  let comments = [];

  const fetchPromise = fetch("https://webdev-hw-api.vercel.app/api/v1/tatyana-pro/comments",
  {
    method: "GET",
  });
  fetchPromise.then((response) => {
    const jsonPromise = response.json();
    jsonPromise.then((responseData)=>{
      comments=responseData.comments;
       console.log(comments);
      renderComments ();
    });
  });
    console.log(comments);
    


  // const comments = [
    // {
      // name: "Глеб Фокин",
      // likes: '3',
      // comment: "Это будет первый комментарий на этой странице",
      // date: "12.02.22 12:18",
      // isLiked: false
    // },
    // {
      // name: "Варвара Н.",
      // likes: '75',
      // comment: "Мне нравится как оформлена эта страница! ❤",
      // date: "13.02.22 19:22",
      // isLiked: false
    // }
  // ];



  const initEventButton = () => {
    const likeButtonsElements = document.querySelectorAll(".like-button");
    const likeCounter = document.querySelectorAll(".likes-counter");
    for (let index = 0; index < likeButtonsElements.length; index++) {
      likeButtonsElements[index].addEventListener('click', (event) => {
        event.stopPropagation();
        console.log(comments[index]);
        if (comments[index].isLiked) {
          comments[index].likes--
          likeCounter[index].textContent = comments[index].likes;
        } else {
          comments[index].likes++;
          likeCounter[index].textContent = comments[index].likes;
        }
        comments[index].isLiked = !comments[index].isLiked;
        renderComments();
      })
    }
  };
  initEventButton();



  const renderComments = () => {
    const commentHtml = comments.map((comment, index) => (
      `<li class="comment"data-comment=${comment.comment}${comment.comment}>
      <div class="comment-header">
         <div data-text="${comment.name}">${comment.name}</div>
         <div>${comment.date}</div>
      </div> 
        <div class="comment-body">
        <div class="comment-text">${comment.comment}</div>
        <div class="comment-footer"><div class="likes"> <span class="likes-counter">${comment.likes}</span>
        <button class="like-button ${comment.isLiked ? "-active-like" : ""}" data-index="${index}"></button></div></div>
   </li>`
    )).join('');
    listElement.innerHTML = commentHtml;
    initEventButton();
  };
  renderComments();




  const answerComment = () => {
    const textComment = document.querySelectorAll(".comment");
    const textarea = document.querySelector(".add-form-text");
    textComment.forEach(element => {
      element.addEventListener("click", (event) => {
        console.log(textComment.dataset.text);
        let content = event.target.innerHTML
        console.log(content);
        textarea.value = content;
        console.log(textarea);
      });
    });
  };
  answerComment ();


  buttonElement.addEventListener("click", () => {
    nameInputElement.classList.remove("error");
    commentInputElement.classList.remove("error");
    if (nameInputElement.value === "") {
      nameInputElement.classList.add("error");
      return;
    }

    if (commentInputElement.value === "") {
      commentInputElement.classList.add("error");
      return;
    }

    comments.push({
      name: nameInputElement.value.replaceAll('<', '&lt').replaceAll('>', '&gt'),
      likes: "0",
      comment: commentInputElement.value,
      date: getCurrentDate(),
      isLiked: false
    });


    fetch("https://webdev-hw-api.vercel.app/api/v1/tatyana-pro/comments",
      {
        method: "POST",
        body: JSON.stringify({
          name: nameInputElement.value.replaceAll('<', '&lt').replaceAll('>', '&gt'),
          likes: "0",
          text: commentInputElement.value,
          date: getCurrentDate(),
          isLiked: false
        }),
      }).then((response) => {
        response.json().then((responseData) => {
          let comments = responseData.comments;
          renderComments();
        });
      });

    renderComments();
    initEventButton();



    commentInputElement.value = '';
    nameInputElement.value = '';
  });

</script>

</html>